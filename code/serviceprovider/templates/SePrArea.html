{% extends 'base.html' %}

{% block head %}
{% endblock %}

{% block body %}

<ul class="breadcrumbs">
    <li> <a href="/serviceprovider">Main</a></li>
    <li> <a href="/serviceprovider/area">{{area['Address']}}</a></li>
</ul>

{% with messages = get_flashed_messages()%}
    {% if messages%}
        {% for message in messages%}
            <p>{{message}}</p>
        {%endfor%}
    {%endif%}
{%endwith%}

<h2>Area Info</h2>  <!-- info about service_tickets -->

{% for ticket in area_tickets %}
    

    {% if ticket['AssignedToMe'] == False and ticket['Assigned'] == True %}
    <div class = areaTicketSpace style="background-color: lightgray">
        This task is taken by another service provider! <br>
        Description: {{ticket['desc']}} <br>
    </div>
    {% else %}

    <button class = areaTicketSpace type="button" data-bs-toggle="modal" data-bs-target="#serviceTicketWindow{{ ticket['_id'] }}" style="background-color: {{ ticket['colour'] }} "> <!-- WORKS, but HTML doesn'think so -->
        {% if ticket['Assigned'] %}
            You have assigned yourself, to handle this ticket! <br>
        {% endif %}
        {% if ticket['Assigned'] == False %}
            Work needs to be done, do you desire to take responsibility for this task? <br>
        {% endif %}
        Description: {{ticket['desc']}} <br>
        DateCreated: {{ticket['DateCreated']}} <br>
        DueDate: {{ticket['DueDate']}} <br>
        <!-- MowerId: {{ticket['MowerId']}} <br> -->
    </button>

    {% endif %}

    {% if ticket['Assigned'] %}
        <form name = "serviceTicket" method="POST" action="{{ url_for('serviceprovider.completeServiceTicket')}}">
    {% endif %}
    {% if ticket['Assigned'] == False %}
        <form name = "serviceTicket" method="POST" action="{{ url_for('serviceprovider.takeServiceTicket')}}">
    {% endif %}
            <div id="serviceTicketWindow{{ ticket['_id'] }}" class="modal fade" role="dialog">
                <div class="modal-dialog modal-md">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="area-create-title"> {{ticket['Content']}} </h4>
                            <button type="button" class="btn close" data-bs-dismiss="modal">&times;</button> <!-- &times is an x symbol-->  
                        </div>

                        <div class="modal-body">
                            {% if ticket['Assigned'] %}
                                You have assigned yourself, to handle this ticket! <br>
                            {% endif %}
                            {% if ticket['Assigned'] == False %}
                                Work needs to be done, do you desire to take responsibility for this task? <br>
                            {% endif %}
                            Description: {{ticket['desc']}} <br>
                            DateCreated: {{ticket['DateCreated']}} <br>
                            DueDate: {{ticket['DueDate']}} <br>
                            {% if 'MowerId' in ticket %}
                                MowerId: {{ticket['MowerId']}} <br>
                            {% endif %}
                        </div>

                        <div class="modal-footer">
                                <button class = "submitButton" type="submit" class="btn footer-button"> 
                                    {% if ticket['Assigned'] %}
                                        Completed 
                                    {% endif %}
                                    {% if ticket['Assigned'] == False %}
                                        Take ticket 
                                    {% endif %}
                                </button>

                            <input type="hidden" id="ticket_id" name="ticket_id" value="{{ ticket['_id'] }}">
                        </div>
                    </div>
                </div>
            </div>
        </form>
   

    

{% endfor %}

<h2> Lawnmowers in {{area['Address']}} </h2>

<div class = "area-mower-space">
    {% for mower in area_mowers %}
        <div class = "mower-object">

        <div class ="mower-title">{{mower["Name"]}}
            <span>
                Id: {{mower['_id']}} <br>
                ExternalSystemSlug: {{mower['ExternalSystemSlug']}}
            </span> 
        </div> <br>

        <div class = "mower-areas">
            {% for address in mower["Addresses"]%}
                {{address}} <br>
            {% endfor %}
        </div>
        <div class = "mower-footer">
            <span>
                x: {{mower["Xpos"]}}
                y: {{mower["Ypos"]}} 

            </span>
            {% if mower['ProviderId'] == providerId %}
                <form name = "removeMower" method = "POST" action="{{ url_for('serviceprovider.removeMower')}}">
                    <button name = "mowerId" value = "{{mower['_id']}}"> Remove </button>
                </form>
            {% endif %}
        </div>
        </div>
    {% endfor %}
</div>


<!-- Add Lawnmower Button -->
{% if area['ProviderId'] == providerId %}
    <button id="addMowerButton" type="button" data-bs-toggle="modal" data-bs-target="#addMowerWindow">
        +
    </button>
{% endif %}
<form name = "addMower" method="POST" action="{{ url_for('serviceprovider.addMower')}}">
    <div id="addMowerWindow" class="modal fade" role="dialog">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="area-create-title">Add Mowers</h4>
                    <button type="button" class="btn close" data-bs-dismiss="modal">&times;</button> <!-- &times is an x symbol-->  
                </div>
                <div class="modal-body">
                    {% for mower in available_mowers %}

                    <button name = "mowerId" value = "{{mower['_id']}}" type = "submit" class = "mower-object">

                        <div class ="mower-title">{{mower["Name"]}}
                            <span>
                                Id: {{mower['_id']}} <br>
                                Mower system slug: {{mower['ExternalSystemSlug']}}
                            </span> 

                        </div> <br>
                        
                        <div class = "mower-areas">
                            {% for address in mower["Addresses"]%}
                            {{address}} <br>
                            {% endfor %}
                        </div>
                        <span class = "mower-footer">
                            x: {{mower["Xpos"]}}
                            y: {{mower["Ypos"]}} 

                        </span>
                    </button>

                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</form>

<br><br><br><br><br><br><br> <!-- Added so that the navigation bar doesn't cover up important stuff -->
{% endblock %}

{% block footer %}
    <form id="nav-bar" id = "footer-navbar" method = "POST" action="{{ url_for('serviceprovider.areaNav')}}">
        <button class = "footer-nav-curr" name = navBar type = "submit" value = "home">
            <p> home </p>
        </button>
        <button class = "footer-nav" name = navBar type = "submit" value = "map">
            <p> map </p>
        </button>
        <button class = "footer-nav" name = navBar type = "submit" value = "schedule">
            <p> schedule</p>
        </button>
        <button class = "footer-nav" name = navBar type = "submit" value = "configuration">
            <p> configuration</p>
        </button>
    </form>
{% endblock %}